<html>
<head>
<title>Program verification with F*</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link REL=STYLESHEET TYPE="text/css" href="../../danel.css">
</head>
<body>
<h1>Program verification with F*</h1>

<p>Guest lecture and accompanying lab sessions for the <a href="https://courses.cs.ttu.ee/pages/Advanced_programming" target="_blank">Advanced Programming Course (ITT8060)</a> at the <a href="https://www.taltech.ee/en/" target="_blank">Tallinn University of Technology</a>.</p>

<h2 id="slides" style="margin-top:30px">Lecture slides (20.11.2019)</h2>

<ul>
<li><a href="slides/out/talk/talk.html" target="_blank">HTML version of the slides</a></li>
</ul>


<h2 id="exercises" style="margin-top:30px">Lab exercises (20-21.11.2019)</h2>

<ul>
<li><a href="ex.zip" target="_blank">ZIP archive</a> with all the exercises</li>
</ul>

<p>These exercises are mostly independent of each other, so you do not need to do them in the given order, but the earlier ones are generally more basic.</p>

<p>Out of all of them, Exercise 7 is probably the most involved. It lets you simultaneously practice the verification of both pure and stateful programs.</p>

<h3>Verifying purely functional programs</h3>

<ul>
<li><b>Exercise 1:</b> Summing 1 + 2 + 3 + ...</li>
<li><b>Exercise 2:</b> Simply typed stacks</li>
<li><b>Exercise 3:</b> Refined stacks</li>
</ul>

<h3>Verifying stateful programs</h3>

<ul>
<li><b>Exercise 4:</b> Stateful summing 1 + 2 + 3 + ...</li>
<li><b>Exercise 5:</b> Stateful factorial 1 * 2 * 3 * ...</li>
<li><b>Exercise 6:</b> Stateful Fibonacci 1 , 1 , 2 , 3 , 5 , 8 , ...</li>
</ul>

<h3>Verifying purely functional and stateful programs</h3>

<ul>
<li><b>Exercise 7:</b> Functional and mutable binary search trees</li>
</ul>

<h3>Verifying monotonic stateful programs</h3>

<ul>
<li><b>Exercise 8:</b> Initializable and freezable references</li>
</ul>

<h2 id="snippets" style="margin-top:30px">Useful code snippets</h2>

<ul>
<li>Ackermann function, interfaces, and decreases metrics: <a href="code/talk/Ackermann.fsti" target="_blank">Ackermann.fsti</a>, <a href="code/talk/Ackermann.fst" target="_blank">Ackermann.fst</a></li>
<li>List reversal: <a href="code/pure-fun/Rev.fst" target="_blank">Rev.fst</a></li>
<li style="margin-bottom:10px">Potential divergence:<a href="code/pure-fun/Divergence.fst" target="_blank">Divergence.fst</a></li>

<li>F*'s ML-style garbage-collected memory model: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Heap.fst" target="_blank">FStar.Heap.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.ST.fst" target="_blank">FStar.ST.fst</a></li>
<li style="margin-bottom:10px">F*'s low-level memory model: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.HyperStack.fst" target="_blank">FStar.HyperStack.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.HyperStack.ST.fst" target="_blank">FStar.HyperStack.ST.fst</a></li>

<li>Stateful increment function: <a href="code/state/IncrST.fst" target="_blank">IncrST.fst</a>, <a href="code/state/Incr2ST.fst" target="_blank">Incr2ST.fst</a></li>
<li>Reference swapping: <a href="code/state/SwapRefsST.fst" target="_blank">SwapRefsST.fst</a></li>
<li>Stateful counting: <a href="code/state/CountST.fst" target="_blank">CountST.fst</a>
<li style="margin-bottom:10px">Low-level code example: <a href="code/state/BufferAlloc.fst" target="_blank">BufferAlloc.fst</a>, <a href="code/state/BufferAlloc.c" target="_blank">BufferAlloc.c</a></li>

<li>F*'s witnessed modality: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Monotonic.Witnessed.fsti" target="_blank">FStar.Monotonic.Witnessed.fsti</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Monotonic.Witnessed.fst" target="_blank">FStar.Monotonic.Witnessed.fst</a></li>
<li>F*'s monotonic ML-style memory model: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Monotonic.Heap.fst" target="_blank">FStar.Monotonic.Heap.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.ST.fst" target="_blank">FStar.ST.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Ref.fst" target="_blank">FStar.Ref.fst</a></li>
<li style="margin-bottom:10px">F*'s monotonic low-level memory model: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Monotonic.HyperStack.fst" target="_blank">FStar.Monotonic.HyperStack.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.HyperStack.ST.fst" target="_blank">FStar.HyperStack.ST.fst</a></li>

<li style="margin-bottom:10px">Classical logic in F*: <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Classical.fsti" target="_blank">FStar.Classical.fsti</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.Classical.fst" target="_blank">FStar.Classical.fst</a>, <a href="https://github.com/FStarLang/FStar/blob/master/ulib/FStar.StrongExcludedMiddle.fst" target="_blank">FStar.StrongExcludedMiddle.fst</a></li>

<li>Monotonic counters: <a href="code/monotonic/CounterMST.fst" target="_blank">CounterMST.fst</a></li>
<li>Monotonic logs: <a href="code/monotonic/SimpleLogMST.fst" target="_blank">SimpleLogMST.fst</a></li>
<li>Temporarily violating monotonicity with snapshots: <a href="code/monotonic/Snapshots.fst" target="_blank">Snapshots.fst</a></li>
</ul>

<h2 id="solutions" style="margin-top:30px">Sample solutions</h2>

<ul>
<li><a href="sols.zip" target="_blank">ZIP archive</a> with solutions to all exercises</li>
</ul>

<h2 id="setup" style="margin-top:30px">Setup instructions</h2>

<h3>Using F* in your browser</h3>

<ul>
<li style="margin-bottom:10px">
The easiest way to try out F* quickly is directly in your browser
using <a href="https://www.fstar-lang.org/run.php" target="_blank">the online editor</a>
that's part of the <a href="https://www.fstar-lang.org/tutorial/" target="_blank">F* tutorial</a>.
</li>
</ul>

<h3>Deploying F* on your computer</h3>

<ul>
<li style="margin-bottom:10px">
For people who want to get F* installed on their computer with little fuzz there are 4 easy options:
<ol>
<li style="margin-bottom:5px; margin-top:10px;"> Using the <a href="https://fstar-lang.org/#download">binary releases</a>
(<a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#binary-releases">documentation on this</a>):
</li>
<ul>
<li style="margin-bottom:5px;">WARNING: The most recent (development) version of F* and its libraries are often not compatible with these binary releases.</li>
<li style="margin-bottom:10px;">In order to get more recent, but also more experimental binary builds please look at the automatically generated <a href="https://github.com/FStarLang/binaries/tree/master/weekly" target="_blank">weekly builds</a> (Linux and Windows only).</li>
</ul>
<li style="margin-bottom:5px; margin-top:10px;">Using the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#opam-package">OPAM package</a>
(especially for people already using OCaml):
</li>
<ul>
<li style="margin-bottom:5px;">WARNING: As with the binary releases, the stable version of F* on OPAM is often not compatible with with the most recent (develoment) version of F* and its libraries.</li>
<li style="margin-bottom:5px;">In order to install the recent (development) version of F* through OPAM, please follow the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#opam-package"  target="_blank">instructions</a>.</li>
<li style="margin-bottom:10px;">IMPORTANT: You need to additionally download and add to your PATH a supported version of the Z3 SMT-solver, see the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#runtime-dependency-z3-smt-solver" target="_blank">instructions</a>.</li>
</ul>
<li style="margin-bottom:5px; margin-top:10px;">
Using the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#homebrew-formula-for-mac-os-x" target="_blank">Homebrew formula</a> (if you are a macOS user):
</li>
<ul>
<li style="margin-bottom:5px;">WARNING: As with the binary releases, the stable version of F* on Homebrew is often not compatible with with the most recent (develoment) version of F* and its libraries.</li>
<li style="margin-bottom:10px;">In order to install the recent (development) version of F* through Homebrew, please follow the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#homebrew-formula-for-mac-os-x" target="_blank">instructions</a>.</li>
</ul>
<li>
Using the <a href="https://store.docker.com/community/images/fstarlang/fstar-emacs" target="_blank">Docker container</a> (especially for people who already  have <a href="https://www.docker.com/get-started" target="_blank">Docker</a> on their computer):
<ul>
<li style="margin-bottom:5px;margin-top:10px">
Get the F* Docker container: <code class="one-liner">docker pull fstarlang/fstar-emacs</code>
</li>
<li style="margin-bottom:5px">
NOTE: This gets you the most recent F* build, the supported version of Z3, and also the Emacs fstar-mode (to use Emacs in GUI mode, follow these <a href="https://github.com/FStarLang/FStar/wiki/Running-F%2A-from-a-docker-image" target="_blank">instructions</a>).
</li>
<li style="margin-bottom:5px">
In order to persist your work between subsequent docker and container runs, create a volume to keep your exercises and code: <code class="one-liner">docker volume create fstar-vol</code>
</li>
<li style="margin-bottom:5px">
Run the container and log into it: <code class="one-liner">docker run -i -t --mount source=fstar-vol,target=/fstar-vol fstarlang/fstar-emacs</code>
</li>
<li style="margin-bottom:5px">
In the container, you might need to change the hard-coded <a href="https://github.com/FStarLang/fstar-mode.el">fstar-mode</a> include paths in <tt style="font-size:11px">~/.emacs</tt> to match the user you are logged into the container with<sup>&dagger;</sup>.
</li>
<li style="margin-bottom:5px">
Also in the container, change the owner of the <tt style="font-size:11px">/fstar-vol</tt> volume to <tt style="font-size:11px">build</tt>: <code class="one-liner">sudo chown -R build:build /fstar-vol</code>
</li>
<li style="margin-bottom:5px">
And you are all set to write and verify programs in F*: <code class="one-liner">cd /fstar-vol ; cp ~/FStar/examples/hello/Hello.fst . ; emacs Hello.fst</code>
</li>
<li style="margin-bottom:5px">
If needed for exercises, you can find the F* standard library in <tt style="font-size:11px">~/FStar/ulib</tt> and various examples in <tt style="font-size:11px">~/FStar/examples</tt>.
</li>
<li style="margin-bottom:5px">
After you <code class="one-liner">exit</code> the container, you can restart it by looking up its ID using <code class="one-liner">docker ps -a</code> and running <code class="one-liner">docker start -i CONTAINER_ID</code>.
</li>
</ul>
</li>
</ol>
</li>
<li style="margin-bottom:10px;">
People who are more motivated and more adventurous can of course also build F* directly from its sources, see the <a href="https://github.com/FStarLang/FStar/blob/master/INSTALL.md#building-f-from-sources">documentation</a>.
</li>
</ul>

<p style="margin-bottom:20px;margin-left:10px">
<sup>&dagger;</sup>At the time of writing these instructions, this meant replacing the hard-coded user name <tt style="font-size:11px">FStar</tt> with the user name <tt style="font-size:11px">build</tt> in the following line in <tt style="font-size:11px">~/.emacs</tt>:
<br/>
<code class="one-liner">(setq fstar-subp-prover-args '("--include" "/home/FStar/FStar/ucontrib/Platform/fst" "--include" "/home/FStar/FStar/ucontrib/CoreCrypto/fst"))</code>
</p>

<h3>Using F* interactively</h3>

<ul>
<li style="margin-bottom:20px">
If you are familiar with the <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs text editor</a>, it is recommended getting
<a href="https://github.com/FStarLang/fstar-mode.el">fstar-mode</a> for it to make the most of F*'s interactive features.
</li>
</ul>

<h2 style="margin-top:30px">More references</h2>
<ul>
<li style="margin-bottom:5px;"><a href="https://www.fstar-lang.org" target="_blank">F* website</a></li>
<li style="margin-bottom:5px;"><a href="https://www.fstar-lang.org/tutorial/" target="_blank">F* tutorial</a></li>
<li style="margin-bottom:5px;"><a href="https://github.com/FStarLang/FStar" target="_blank">F* code on GitHub</a></li>
<li style="margin-bottom:5px;"><a href="https://github.com/FStarLang/kremlin" target="_blank">KreMLin compiler for Low*</a></li>
<li style="margin-bottom:5px;"><a href="https://project-everest.github.io" target="_blank">Project Everest</a></li>
</ul>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97024345-1', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
